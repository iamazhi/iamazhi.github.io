(window.webpackJsonp=window.webpackJsonp||[]).push([["dx_PtD"],{dx_DCFt:function(e,n,o){"use strict";var r=o("dx_pVnL"),c=o.n(r),i=o("dx_cDcd"),a=o("dx_A2Rh");function l(e){return i.createElement("svg",c()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i.createElement("path",{d:"m13.058 6.472 5.637 5.636-5.944 5.943-.835.84a1 1 0 1 0 1.419 1.409l.663-.667 6.818-6.818a1 1 0 0 0 0-1.414l-6.472-6.473-1.012-1.013a1 1 0 0 0-1.416 1.41l1.142 1.147Z",fill:"currentColor"}),i.createElement("path",{d:"m4.15 6.472 5.637 5.636-5.943 5.943-.836.84A1 1 0 1 0 4.427 20.3l.663-.667 6.818-6.818a1 1 0 0 0 0-1.414L5.436 4.928 4.424 3.915a1 1 0 0 0-1.415 1.41L4.15 6.472Z",fill:"currentColor"}))}var m=i.forwardRef((function(e,n){return i.createElement(a.S,c()({icon:l},e,{ref:n,svgProps:{"data-icon":"DownRightOutlined"}}))}));n.S=m},dx_FHNI:function(e,n,o){"use strict";o.d(n,"F",(function(){return C})),o.d(n,"t",(function(){return v})),o.d(n,"j",(function(){return p})),o.d(n,"l",(function(){return _}));var r=o("dx_VkAN"),c=o.n(r),i=o("dx_Dtiu"),a=o.n(i),l=o("dx_yzqx"),m=o("dx_eGDr");function u(){var e=c()(["\n  position: relative;\n  height: 100%;\n  font-size: 12px;\n  border-radius: 2px;\n  color: var(--static-white);\n  background-color: var(--Y500);\n  width: ","px;\n  height: ","px;\n  line-height: ","px;\n  top: ","px;\n  left: ","px;\n  cursor: pointer;\n  html[data-theme='dark'] & {\n    background-color: var(--Y400);\n  }\n  &::after {\n    content: ' ';\n    bottom: -8px;\n    border: 4px solid transparent;\n    border-top-color: var(--Y500);\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n    html[data-theme='dark'] & {\n      border-top-color: var(--Y400);\n    }\n  }\n"]);return u=function(){return e},e}function s(){var e=c()(["\n  background-color: transparent;\n  height: 100%;\n"]);return s=function(){return e},e}function d(){var e=c()(["\n  position: absolute;\n  right: 0;\n  line-height: ","px;\n  // \u5de6\u4fa7\u586b\u5145 10px \u89e3\u51b3\u534e\u4e3a\u66f2\u9762\u5c4f\u96be\u70b9\u51fb\u5230\u6c14\u6ce1\u7684\u95ee\u9898\n  margin-left: -10px;\n  padding-left: 10px;\n  width: ","px;\n  height: ","px;\n  // margin-left: .06rem;\n  margin-top: ","px;\n  border-radius: ","px;\n  // margin-top: 1px; // \u5e94\u8be5\u548c\u8bc4\u8bba\u7ebf\u8054\u52a8\n  text-align: center;\n"]);return d=function(){return e},e}function f(){var e=c()(["\n  position: absolute;\n  top: 0;\n  right: ",";\n  // padding-top: .32rem;\n  z-index: 3;\n  user-select: none;\n"]);return f=function(){return e},e}var C=a.a.div(f(),l.S.isMobile?0:"12px"),v=a.a.div(d(),m.T,m.z+10,m.I,-(m.I-m.T)/2,m.z/2),p=a.a.div(s()),_=a.a.div(u(),m.s,m.T,m.T,(m.I-m.T)/2,(m.z-m.s)/2+1)},dx_K1As:function(e,n,o){"use strict";o.d(n,"S",(function(){return j}));var r,c=o("dx_lSNA"),i=o.n(c),a=o("dx_J4zp"),l=o.n(a),m=o("dx_lwsE"),u=o.n(m),s=o("dx_W8MJ"),d=o.n(s),f=o("dx_W7W2"),C=o.n(f),v=o("dx_a1gu"),p=o.n(v),_=o("dx_Nsbk"),E=o.n(_),h=o("dx_uxuX"),g=o("dx_NWnn"),O=o("dx_UtDZ"),b=o("dx_h6a8"),S=o("dx_zUqt"),I=o("dx_Fimk"),A=o("dx_Ayao"),T=o("dx_D8nn"),M=o("dx_O1Ou");function y(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,r)}return o}function x(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?y(Object(o),!0).forEach((function(n){i()(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):y(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function w(e,n){var o;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=function(e,n){if(!e)return;if("string"===typeof e)return N(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return N(e,n)}(e))||n&&e&&"number"===typeof e.length){o&&(e=o);var r=0,c=function(){};return{s:c,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==o.return||o.return()}finally{if(l)throw i}}}}function N(e,n){(null==n||n>e.length)&&(n=e.length);for(var o=0,r=new Array(n);o<n;o++)r[o]=e[o];return r}function k(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=E()(e);if(n){var c=E()(this).constructor;o=Reflect.construct(r,arguments,c)}else o=r.apply(this,arguments);return p()(this,o)}}!function(e){e.COMMENT_FOLLOW="CommentFollow",e.COMMENT_TOGGLE="CommentToggle",e.COMMENT_IMAGE_PREVIEW="CommentImagePreview",e.COMMENT_ACTIVE="CommentActive",e.COMMENT_EXPAND="CommentExpand",e.ACTIVE_COMMENT_SCROLL_OUT="ActiveCommentScrollOut",e.LATEST_ACTIVE_COMMENT_ID_CHANGE="latestActiveCommentIdChange",e.Scroll_Comment="ScrollComment"}(r||(r={}));var j=function(e){C()(o,e);var n=k(o);function o(e){var c;return u()(this,o),(c=n.call(this)).pluginName="follow",c.shown=void 0,c.eventEmitter=void 0,c.commentView=void 0,c.commentModule=void 0,c.vcController=void 0,c.unregisterVcController=void 0,c.showComment=void 0,c.activeCommentId=null,c.activeCommentVisible=!0,c.expandedCommentIds=new Set,c.positionListRef=void 0,c.commentListRef=void 0,c.notFoundCommentActiveAction=void 0,c.notFoundCommentImagePreviewAction=void 0,c.isPresentV2=!1,c.fileType=void 0,c.preScrollData=void 0,c._disableSendScrollCommentAction=!1,c.newClickContentAlignEnabled=void 0,c.cancelSendCommentScrollActionTimer=null,c.cycleHandler=function(e){switch(e){case h.START_FOLLOW:c.deactivateComment();break;case h.STOP_FOLLOW:c.clear("stop follow");break;case h.START_RECORD:c.activeCommentId&&!c.activeCommentVisible&&(c.deactivateComment(),c.sendActiveCommentScrollOutState(c.activeCommentId)),c.handleActiveCommentScroll(c.preScrollData)}},c.replayFollowActionHandler=function(e){try{var n=e.uuid,i=e.actionType,a=e.data;if(i===r.COMMENT_FOLLOW){var l=a.commentTransformY;c.eventEmitter.trigger("setAnchorPayload",[l]),c.vcController.reportReplay(M.s.SUCCESS,n)}else if(i===r.COMMENT_TOGGLE){var m=a.isOpen;c.shown=m,c.showComment(m),m||c.clear("comment panel close"),c.vcController.reportReplay(M.s.SUCCESS,n)}else if(i===r.LATEST_ACTIVE_COMMENT_ID_CHANGE){var u=a.commentId;c.eventEmitter.trigger("setAnchorComment",[u]),c.vcController.reportReplay(M.s.SUCCESS,n)}else if(i===r.COMMENT_ACTIVE){var s=a,d=s.commentId,f=s.isTmpComment,C=s.V2,v=void 0!==C&&C;if(c.isPresentV2=v,f)return void c.vcController.reportReplay(M.s.IGNORE,n,"temp comment no use");if(c.notFoundCommentActiveAction&&(c.vcController.reportReplay(M.s.IGNORE,c.notFoundCommentActiveAction.uuid,"ignore not find comment active cause next action come"),Object(I.N)("vc_action_apply_dev",{code:1,info:"comment is not found",uuid:c.notFoundCommentActiveAction.uuid,action:"".concat(o.MODULE_NAME,"-").concat(r.COMMENT_ACTIVE),string_param_1:JSON.stringify(c.positionListRef.current||{}),string_param_2:JSON.stringify(a)}),c.notFoundCommentActiveAction=void 0),!d)return c.activeCommentId=null,c.deactivateComment(),void c.vcController.reportReplay(M.s.SUCCESS,n);if(!c.isCommentExistInView(d))return void(c.notFoundCommentActiveAction=e);if(c.activeCommentId===d)return void c.vcController.reportReplay(M.s.SUCCESS,n);c.activeCommentId=d,c.activateComment(d),c.vcController.reportReplay(M.s.SUCCESS,n)}else if(e.actionType===r.COMMENT_EXPAND){if(!e.data.expanded||!(e.data.expanded instanceof Array))return void c.vcController.reportReplay(M.s.IGNORE,n,"no need");c.handleCommentExpandStatusUpdate(a.expanded),c.vcController.reportReplay(M.s.SUCCESS,n)}else if(i===r.COMMENT_IMAGE_PREVIEW){var p=a,_=p.commentId,E=p.replyId,h=p.imageIndex;if(p.isGlobal)return void c.vcController.reportReplay(M.s.IGNORE,n,"global comment image ignore");if(c.notFoundCommentImagePreviewAction&&(c.vcController.reportReplay(M.s.IGNORE,c.notFoundCommentImagePreviewAction.uuid,"ignore not find comment img preview cause next action come"),Object(I.N)("vc_action_apply_dev",{code:1,info:"comment reply image is not found",uuid:c.notFoundCommentImagePreviewAction.uuid,action:"".concat(o.MODULE_NAME,"-").concat(r.COMMENT_IMAGE_PREVIEW),string_param_1:JSON.stringify(c.commentListRef.current||{}),string_param_2:JSON.stringify(c.notFoundCommentImagePreviewAction.data)}),c.notFoundCommentImagePreviewAction=void 0),_&&E&&!c.isReplyExist(_,E))return void(c.notFoundCommentImagePreviewAction=e);c.eventEmitter.trigger("imagePreview",[{commentId:_,replyId:E,imageIndex:h}]),c.vcController.reportReplay(M.s.SUCCESS,n)}else if(i===r.Scroll_Comment){var g=2===window.vcSdk.context.presenter_device_type;if(window.vcSdk.isRecord||c.fileType&&"sheet"!==c.fileType&&"bitable"!==c.fileType&&!g)return void c.vcController.reportReplay(M.s.IGNORE,n,"pc no use");var O=a,b=O.commentId,S=O.replyId,A=O.replyPercentage,T=O.scrollTop;c.eventEmitter.trigger("followActiveCommentScroll",[b,S,A,T]),c.vcController.reportReplay(M.s.SUCCESS,n)}}catch(y){c.vcController.reportReplay(M.s.FAIL,e.uuid,y.message)}},c.handleCommentExpandStatusUpdate=function(e){var n,o=new Set(c.expandedCommentIds),r=new Set,i=w(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;c.expandedCommentIds.has(a)?o.delete(a):r.add(a)}}catch(O){i.e(O)}finally{i.f()}var m,u=w(r);try{for(u.s();!(m=u.n()).done;){var s=m.value.split("$$"),d=l()(s,2),f=d[0],C=d[1];c.eventEmitter.trigger("setTextExpandStatus",[{commentId:f,replyId:C,expanded:!0}])}}catch(O){u.e(O)}finally{u.f()}var v,p=w(o);try{for(p.s();!(v=p.n()).done;){var _=v.value.split("$$"),E=l()(_,2),h=E[0],g=E[1];c.eventEmitter.trigger("setTextExpandStatus",[{commentId:h,replyId:g,expanded:!1}])}}catch(O){p.e(O)}finally{p.f()}c.expandedCommentIds=new Set(e)},c.presenterActionHandler=function(e){var n=e.actionType,o=e.data;n===r.COMMENT_IMAGE_PREVIEW&&c.sendPosition(M.f.PRESENTER,o)},c.triggerShowComment=function(e){c.vcController.sendState(o.MODULE_NAME,r.COMMENT_TOGGLE,{isOpen:e},!0)},c.handleActiveCommentChange=function(e){var n=e.activeCommentId;c.activeCommentId=n&&Object(g.isLocalId)(n)?null:n,c.vcController.sendState(o.MODULE_NAME,r.COMMENT_ACTIVE,{commentId:c.activeCommentId,V2:c.commentModule.disableScrollInVC},!0);var i=c.vcController.getState(M.a.DocComment,r.ACTIVE_COMMENT_SCROLL_OUT);((null===i||void 0===i?void 0:i.commentId)||null)!==n&&c.sendActiveCommentScrollOutState(null),c.activeCommentVisible=!0,c.activeCommentId&&c.vcController.sendState(o.MODULE_NAME,r.LATEST_ACTIVE_COMMENT_ID_CHANGE,{commentId:n},!0)},c.handleActiveCommentScroll=function(e){c.preScrollData=e;var n=e.commentId,i=e.replyId,a=e.replyPercentage,l=e.scrollTop,m=e.isSheetAtDoc;!c.vcController.isRecord||c.disableSendScrollCommentAction&&-1!==a||c.vcController.sendState(o.MODULE_NAME,r.Scroll_Comment,{commentId:n,replyId:i,replyPercentage:a,scrollTop:l,isSheetAtDoc:m},!0)},c.handleFollowScrollTopChange=function(e){T.N.emit(A.M.FOLLOW_SCROLL_TOP_CHANGE,e)},c.handleAnchorPayloadChange=function(e){var n=e.anchorPayload;c.vcController.sendState(o.MODULE_NAME,r.COMMENT_FOLLOW,{commentTransformY:n},!0)},c.sendActiveCommentScrollOutState=function(e){c.vcController.sendState(o.MODULE_NAME,r.ACTIVE_COMMENT_SCROLL_OUT,{commentId:e},!0)},c.handleCommentPanelVisibleChange=function(e){if(c.activeCommentId){var n=e.find((function(e){return e.commentId===c.activeCommentId})),o=!!n&&!n.visible;if(!c.vcController.isRecord)return n&&(c.activeCommentVisible=!o),void c.sendActiveCommentScrollOutState(null);o&&c.sendActiveCommentScrollOutState(c.activeCommentId)}else c.activeCommentVisible=!0},c.textExpandStatusDidUpdate=function(e,n,i){i?c.expandedCommentIds.add("".concat(e,"$$").concat(n)):c.expandedCommentIds.delete("".concat(e,"$$").concat(n)),c.vcController.sendState(o.MODULE_NAME,r.COMMENT_EXPAND,{expanded:Array.from(c.expandedCommentIds)},!0)},c.triggerActiveComment=function(e){if(c.notFoundCommentActiveAction){var n=c.notFoundCommentActiveAction.data.commentId;n&&c.isCommentExistInView(n)&&(c.activateComment(n),c.vcController.reportReplay(M.s.SUCCESS,c.notFoundCommentActiveAction.uuid),c.notFoundCommentActiveAction=void 0)}if(c.notFoundCommentImagePreviewAction){var o=c.notFoundCommentImagePreviewAction.data,r=o.commentId,i=o.replyId,a=o.imageIndex;if(!c.isReplyExist(r,i,e))return;c.eventEmitter.trigger("imagePreview",[{commentId:r,replyId:i,imageIndex:a}]),c.vcController.reportReplay(M.s.SUCCESS,c.notFoundCommentImagePreviewAction.uuid),c.notFoundCommentImagePreviewAction=void 0}},c.getActiveCommentId=function(){return c.activeCommentId},c.handleDocXActiveCommentBeforeChange=function(){c._disableSendScrollCommentAction=!0},c.handleDocXActiveCommentChange=function(){c.cancelSendCommentScrollActionTimer=window.setTimeout((function(){c.cancelSendCommentScrollActionTimer=null,c._disableSendScrollCommentAction=!1,c.commentView.eventEmitter.emit("cancelNextHandlePresenterScrollComment")}),50)},c.eventEmitter=e.eventEmitter,c.vcController=e.vcController,c.fileType=e.fileType,c.showComment=e.showComment,c.positionListRef=e.positionListRef,c.commentListRef=e.commentListRef,c.commentView=e.commentView,c.commentModule=e.commentModule,c.newClickContentAlignEnabled=e.newClickContentAlignEnabled,c.commentView.on("activeCommentChange",c.handleActiveCommentChange),c.commentView.on("anchorPayloadChange",c.handleAnchorPayloadChange),c.commentView.on("commentPanelVisibleChange",c.handleCommentPanelVisibleChange),c.commentView.on("activeCommentScroll",c.handleActiveCommentScroll),c.commentView.on("followScrollTopChange",c.handleFollowScrollTopChange),c.commentModule.on(A.M.ACTIVE_COMMENT_CHANGE_BEFORE_SCROLL,c.handleDocXActiveCommentBeforeChange),c.commentModule.on(A.M.ACTIVE_COMMENT_CHANGE,c.handleDocXActiveCommentChange),c.registerVcController(),c}return d()(o,[{key:"disableSendScrollCommentAction",get:function(){return!!this.newClickContentAlignEnabled&&this._disableSendScrollCommentAction}}]),d()(o,[{key:"registerVcController",value:function(){var e,n=this;this.unregisterVcController||(this.unregisterVcController=this.vcController.register({moduleName:o.MODULE_NAME,defaultState:(e={},i()(e,r.COMMENT_ACTIVE,{commentId:null}),i()(e,r.COMMENT_IMAGE_PREVIEW,{commentId:"",replyId:"",imageIndex:-1,isGlobal:!1}),i()(e,r.COMMENT_FOLLOW,{commentTransformY:0}),i()(e,r.COMMENT_EXPAND,{expanded:[]}),i()(e,r.ACTIVE_COMMENT_SCROLL_OUT,{commentId:null}),i()(e,r.LATEST_ACTIVE_COMMENT_ID_CHANGE,{commentId:null}),i()(e,r.Scroll_Comment,{commentId:"",replyId:"",replyPercentage:0}),e),replayHandler:this.replayFollowActionHandler,cycleHandler:this.cycleHandler,presenterHandler:this.presenterActionHandler,muteOptions:{duration:1e3,check:function(e,o){var c;return(!(null===(c=n.commentModule.vcPosition)||void 0===c?void 0:c.core.state.isPresenterV2)||!n.commentModule.disableScrollInVC)&&(e.actionType===r.COMMENT_ACTIVE&&(!!e.data.commentId&&(o.moduleName===M.a.DocxPosition&&"position"===o.actionType)))}},retryOnVersionMatched:"fail-only",checkSame:function(e,n,o){switch(e){case r.COMMENT_ACTIVE:return n.isTmpComment||n.commentId===o.commentId;case r.ACTIVE_COMMENT_SCROLL_OUT:return!0;case r.COMMENT_IMAGE_PREVIEW:if(-1===n.imageIndex&&-1===o.imageIndex)return!0;if(n.isGlobal!==o.isGlobal)return Object(b.isEqual)(x(x({},n),{},{isGlobal:void 0}),x(x({},o),{},{isGlobal:void 0}));break;case r.Scroll_Comment:if(2!==window.vcSdk.context.presenter_device_type)return!0}return Object(b.isEqual)(n,o)}}))}},{key:"isCommentExistInView",value:function(e){var n;return!!(null===(n=this.positionListRef.current)||void 0===n?void 0:n.find((function(n){return n.commentId===e})))}},{key:"isReplyExist",value:function(e,n,o){return!(!this.commentListRef.current&&!o)&&(o||this.commentListRef.current).some((function(o){var r=o.commentId,c=o.replyList;return e===r&&c.some((function(e){var o=e.replyId;return n===o}))}))}},{key:"sendPosition",value:function(e,n){var o=n.commentId,r=void 0===o?"":o,c=n.replyId,i=void 0===c?"":c,a=n.imageIndex;this.vcController.sendPosition(e,{space:r&&a>-1?"".concat(r,":").concat(i,":").concat(a):Object(O.encryptTea)(Object(S.k)())})}},{key:"activateComment",value:function(e){this.shown=!0,this.showComment(this.shown),this.commentView.setActiveComment(e,{isPresentOldVersion:!this.isPresentV2})}},{key:"deactivateComment",value:function(){this.commentView.setActiveComment(null)}},{key:"commentImagePreviewed",value:function(e){var n=e.commentId,c=e.replyId,i=e.imageIndex;void 0!==n&&void 0!==c&&this.vcController.sendState(o.MODULE_NAME,r.COMMENT_IMAGE_PREVIEW,{commentId:n,replyId:c,imageIndex:i,isGlobal:!1},!0)}},{key:"clear",value:function(e){this.notFoundCommentActiveAction&&(this.vcController.reportReplay(M.s.IGNORE,this.notFoundCommentActiveAction.uuid,"ignore not found comment active cause ".concat(e)),this.notFoundCommentActiveAction=void 0),this.notFoundCommentImagePreviewAction&&(this.vcController.reportReplay(M.s.IGNORE,this.notFoundCommentImagePreviewAction.uuid,"ignore not found comment img preview cause ".concat(e)),this.notFoundCommentImagePreviewAction=void 0)}},{key:"destroy",value:function(){var e;this.clear("plugin destroy"),this.commentView.off("activeCommentChange",this.handleActiveCommentChange),this.commentView.off("anchorPayloadChange",this.handleAnchorPayloadChange),this.commentView.off("commentPanelVisibleChange",this.handleCommentPanelVisibleChange),this.commentView.off("activeCommentScroll",this.handleActiveCommentScroll),this.commentView.off("followScrollTopChange",this.handleFollowScrollTopChange),this.commentModule.off(A.M.ACTIVE_COMMENT_CHANGE_BEFORE_SCROLL,this.handleDocXActiveCommentBeforeChange),this.commentModule.off(A.M.ACTIVE_COMMENT_CHANGE,this.handleDocXActiveCommentChange),null===(e=this.unregisterVcController)||void 0===e||e.call(this),this.cancelSendCommentScrollActionTimer&&window.clearTimeout(this.cancelSendCommentScrollActionTimer)}}]),o}(g.CommentViewPlugin);j.MODULE_NAME=M.a.DocComment},dx_MQSr:function(e,n,o){"use strict";(function(t){var e=o("dx_lSNA"),r=o.n(e),c=o("dx_o0o1"),i=o.n(c),a=o("dx_yXPU"),l=o.n(a),m=o("dx_J4zp"),u=o.n(m),s=o("dx_lwsE"),d=o.n(s),f=o("dx_W8MJ"),C=o.n(f),v=o("dx_W7W2"),p=o.n(v),_=o("dx_a1gu"),E=o.n(_),h=o("dx_Nsbk"),g=o.n(h),O=o("dx_uxuX"),b=o("dx_Icqc"),S=o("dx_NWnn"),I=o("dx_n2nw"),A=o("dx_DCFt"),T=o("dx_PcQO"),M=o("dx_UtDZ"),y=o("dx_cDcd"),x=o.n(y),w=o("dx_h74D"),N=o("dx_oncg"),k=o("dx_mf1r"),j=o("dx_rQGm"),R=o("dx_yzqx"),D=o("dx_UHze"),P=o("dx_ABiD"),L=o("dx_rrS6"),V=o("dx_GPzN"),G=o("dx_A3AG"),F=o("dx_BmAg"),H=o("dx_k64k"),U=o("dx_Fimk"),B=o("dx_zEdG"),W=o("dx_c6Cp"),Y=o("dx_eSV8"),z=o("dx_B28d"),K=o("dx_eGDr"),X=o("dx_Ayao"),q=o("dx_D8nn"),J=o("dx_sNGG"),$=o("dx_MlPX"),Q=o("dx_U5UJ"),Z=o("dx_qx8A"),ee=o.n(Z),te=o("dx_xBwW"),ne=o("dx_NwkU"),oe=o("dx_oQzG"),re=o("dx_kQkB"),ce=o("dx_DlF2"),ie=o("dx_K1As");function ae(e,n){var o;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=function(e,n){if(!e)return;if("string"===typeof e)return le(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return le(e,n)}(e))||n&&e&&"number"===typeof e.length){o&&(e=o);var r=0,c=function(){};return{s:c,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==o.return||o.return()}finally{if(l)throw i}}}}function le(e,n){(null==n||n>e.length)&&(n=e.length);for(var o=0,r=new Array(n);o<n;o++)r[o]=e[o];return r}function me(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,r)}return o}function ue(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?me(Object(o),!0).forEach((function(n){r()(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):me(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function se(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=g()(e);if(n){var c=g()(this).constructor;o=Reflect.construct(r,arguments,c)}else o=r.apply(this,arguments);return E()(this,o)}}var de,fe=M.commentPieces.CheckComment,Ce=M.commentPieces.CommentReporterNewPlugin,ve=M.commentPieces.CommentWilldeprecatedReporterPlugin,pe=M.commentPieces.StartCheckBtn,_e=new Set([K.M.interaction,K.M.thirdParty]),Ee=function(e){p()(o,e);var n=se(o);function o(e){var r;return d()(this,o),(r=n.call(this)).commentModule=void 0,r.isInCheckComment=void 0,r.pluginName="main",r.rootSelector=void 0,r.commentModule=e.commentModule,r.isInCheckComment=e.isInCheckComment,r.rootSelector=e.rootSelector,r}return C()(o,[{key:"shouldDeactivateCommentWhenClickWindow",value:function(e){var n,o,r,c,i,a,l=document.querySelector(this.rootSelector);return!document.querySelector("#check-comment-container")&&(!(null===(n=(o=e.target).closest)||void 0===n?void 0:n.call(o,".block-menu-overlay"))&&(!(!(null===(r=(c=e.target).closest)||void 0===r?void 0:r.call(c,".fold-handler"))&&!(null===(i=(a=e.target).closest)||void 0===i?void 0:i.call(a,".code-wrap")))||!(null===l||void 0===l?void 0:l.contains(e.target))))}},{key:"shouldShortcutSwitchActiveComment",value:function(e){if(this.isInCheckComment())return!1;var n=document.querySelector(this.rootSelector);return!(null===n||void 0===n?void 0:n.contains(e.target))}},{key:"activeCommentWillChange",value:function(){return!this.isInCheckComment()}},{key:"commentDidAdd",value:function(e){this.commentModule.handleCommentDidAdd(e)}},{key:"commentDidResolve",value:function(e){this.commentModule.handleCommentDidResolve(e)}},{key:"commentDidDelete",value:function(e,n){this.commentModule.handleCommentDidDelete(e,n)}}]),o}(S.CommentViewPlugin);!function(e){e.SEND_ACTIVE_COMMENT="ACTIVE_COMMENT",e.RECEIVE_ACTIVE_COMMENT="ACTIVE_COMMENT_FROM_CK"}(de||(de={}));var he={root:".".concat(j.b3.ROOT),editor:".".concat(j.b3.PAGE_MAIN_ITEM,".").concat(j.b3.EDITOR)},ge=R.S.isLarkFeed?function(e){var n=e.commentModule,o=e.blockManager,r=e.fold,c=Object(w.useDispatch)(),i=Object(y.useCallback)((function(){c(M.renderHelpers.updateBusinessStage(M.renderHelpers.Business.Docx,M.renderHelpers.DocxStage.CommentRendered))}),[c]);return Object(y.useEffect)((function(){if(!n.getIsReady())return n.on(X.M.COMMENT_READY,i),function(){n.off(X.M.COMMENT_READY,i)};i()}),[n,i]),x.a.createElement(re.S,{commentModule:n,blockManager:o,fold:r})}:Object(N.withRouter)((function(e){var n=e.commentModule,o=e.vcController,r=e.blockManager,c=e.fold,a=e.defaultShow,m=e.scroller,s=e.classMap,d=void 0===s?he:s,f=n.getInnerCommentModule(),C=Object(w.useDispatch)(),v=Object(y.useRef)(null),p=Object(y.useRef)(null),_=Object(y.useRef)(null),E=Object(y.useState)([]),h=u()(E,2),g=h[0],N=h[1],Z=Object(y.useRef)(g),le=Object(y.useState)(!1),me=u()(le,2),se=me[0],ge=me[1],Oe=Object(y.useState)(!0),be=u()(Oe,2),Se=be[0],Ie=be[1],Ae=Object(y.useRef)(!0),Te=Object(y.useRef)([]),Me=Object(y.useState)(!0),ye=u()(Me,2),xe=ye[0],we=ye[1],Ne=Object(w.useSelector)(F.I),ke=Object(y.useRef)(Ne),je=Object(y.useRef)(Ne),Re=Object(y.useRef)(null),De=Object(te.S)(d.root,e.selectionApi),Pe=Object(y.useRef)(!0),Le=e.inPresentationMode,Ve=Object(w.useSelector)(H.F),Ge=Object(y.useRef)(Ve),Fe=Object(y.useState)(null),He=u()(Fe,2),Ue=He[0],Be=He[1],We=Object(w.useSelector)(M.selectUserGuide),Ye=!We||!We.getIn||We.getIn([M.STEP_TYPES.ccm_check_comment_start_guide,"is_done"]),ze=!We||!We.getIn||We.getIn([M.STEP_TYPES.ccm_check_comment_input_guide,"is_done"]),Ke=Object(w.useSelector)(Object(M.selectFetchStatus)("userGuide")),Xe=Object(y.useRef)(null),qe=Object(y.useRef)(null),Je=Object(w.useSelector)(M.selectCurrentUser),$e=Object(w.useSelector)(M.selectCheckCommentShown),Qe=Object(y.useRef)($e),Ze=Object(y.useRef)(!1),et=Object(y.useRef)(0),tt=Object(y.useRef)(null),nt=Object(y.useState)(!1),ot=u()(nt,2),rt=ot[0],ct=ot[1],it=Object(M.getMinaConfig)("ccm.docx.check_comment_enable",!1),at=Object(M.getMinaConfig)("ccm.gpe.comment_draft_enable",!1),lt=Object(M.getMinaConfig)("ccm.gpe.comment-hover-enable",!1),mt=Object(M.getMinaConfig)("ccm.gpe.comment.optimize.loading_and_fail_pc",!1),ut=Object(M.getMinaConfig)("ccm.gpe.comment.optimize.loading_v2_pc",!1),st=Object(M.getMinaConfig)("ccm.ms.comment_follow_enabled",!1),dt=Object(M.getMinaConfig)("ccm.ms.comment_follow_notice_enabled",!1),ft=Object(M.getMinaConfig)("ccm.docx.comment.new_click_content_align",!1),Ct=Object(M.getMinaConfig)("ccm.docx.comment.click_content_comment_scroll_animation",!1),vt=Object(M.getMinaConfig)("ccm.platform.pc.common_mention",!1),pt=Object(y.useState)((null===o||void 0===o?void 0:o.isRecord)||!1),_t=u()(pt,2),Et=_t[0],ht=_t[1],gt=Object(ne.T)({scroller:m,commentModule:n,vcController:o,positionList:g,blockManager:r}),Ot=Object(w.useSelector)(M.selectCurrentSuiteType),bt=Object(w.useSelector)(M.selectCurrentSuiteToken),St=Object(w.useSelector)(M.selectCurrentSuiteShareable),It=Object(y.useRef)(St),At=Object(y.useState)(!1),Tt=u()(At,2),Mt=Tt[0],yt=Tt[1],xt=f.getData().comments.filter((function(e){return!e.finished&&!e.isWhole&&!!g.find((function(n){return n.commentId===e.commentId||n.commentId===e.tmpCommentId}))}));Object(y.useEffect)((function(){return null===o||void 0===o?void 0:o.addListenCycleChange((function(){return ht(null===o||void 0===o?void 0:o.isRecord)}))}),[o]);var wt=Object(y.useRef)(xt),Nt=function(e){M.EventEmitter.emit("CHECK_COMMENT_TOGGLE",{shown:e}),C(M.actions.comment.toggleCheckCommentShown({checkCommentShown:e,rootToken:bt,rootType:Ot}))},kt=function(e){if(f)return f.getData().comments.find((function(n){return n.commentId===e}))},jt=Object(y.useRef)(new L.S({onFirstRenderAfterDataReady:function(){C(M.renderHelpers.updateBusinessStage(M.renderHelpers.Business.Docx,M.renderHelpers.DocxStage.CommentRendered))}})),Rt=Object(y.useCallback)((function(e){je.current=e,C(Object(G.Y)(e)),function(e){if(M.localStorageAvailable&&!R.S.isInVC&&!R.S.isFeishuRooms)try{M.localStorageUtil.setItem("docCommentShown",e)}catch(n){console.warn(n)}}(e),e&&Object(W.J)()}),[C]),Dt=Object(y.useCallback)(l()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ke.current){e.next=2;break}return e.abrupt("return");case 2:if(Rt(!0),!Ae.current){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",new Promise((function(e){Te.current.push(e)})));case 6:case"end":return e.stop()}}),e)}))),[Rt]),Pt=Object(y.useRef)(!1),Lt=Object(y.useRef)(!1),Vt=Object(y.useRef)(!1),Gt=Object(y.useRef)(!1);Pt.current&&!Lt.current&&(Lt.current=!0,V.S.updateLoadMainStageDurationList(M.FILE_TYPE.DOCX,M.LOAD_MAIN_STAGE_DURATION_LIST_KEY.RENDER_FILE_COMMENT_START),Vt.current=!0),Object(y.useEffect)((function(){Vt.current&&!Gt.current&&(Gt.current=!0,V.S.updateLoadMainStageDurationListByNextRender(M.FILE_TYPE.DOCX,M.LOAD_MAIN_STAGE_DURATION_LIST_KEY.RENDER_FILE_COMMENT_SUCCESS))}));var Ft=Object(y.useCallback)((function(){jt.current.dataReady(P.ET.FETCH_DOCX_COMMENT_SUCCESS),jt.current.dataReadyForStage(M.LOAD_MAIN_STAGE_DURATION_LIST_KEY.FETCH_FILE_COMMENT_SUCCESS),Pt.current=!0,yt(!0)}),[]),Ht=Object(y.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=e.animate,r=void 0!==o&&o,c=n.getDocComments(!0,!0),i=n.getPositionList().filter((function(e){var n=e.commentId;return c.has(n)}));N(i),p.current&&p.current.setPositionList(i,{animate:r})}),[n]),Ut=Object(y.useCallback)(function(){var e=l()(i.a.mark((function e(o){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dt();case 2:n.startNewDocComment(o);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[n,Dt]),Bt=Object(y.useCallback)(function(){var e=l()(i.a.mark((function e(n){var o,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.commentId,r=n.from,tt.current=o,e.next=4,Dt();case 4:p.current&&tt.current===o&&(c=ft&&_e.has(r||"")?{source:S.ActiveCommentSource.Editor}:void 0,p.current.setActiveComment(o,c),De());case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[Dt,De]),Wt=Object(y.useCallback)((function(){var e;Qe.current||(null===(e=p.current)||void 0===e||e.setActiveComment(null),tt.current=null)}),[]),Yt=Object(y.useCallback)((function(){Ie(!0)}),[Ie]),zt=Object(y.useCallback)((function(){Ie(!1),we(!1),Rt(!Ne)}),[Ne,Rt]),Kt=Object(y.useCallback)((function(e){var o=e.activeCommentId;tt.current=o,M.store.dispatch(M.actions.suite.setHelpBtnVisible(!o)),n.activeCommentChange(ue(ue({},e),{},{callSource:"SDKActiveCommentChange"})),Be(o)}),[n]),Xt=Object(y.useCallback)((function(e){n.hoverCommentChange(e)}),[n]),qt=Object(y.useCallback)((function(e){ge(!e)}),[]),Jt=Object(y.useCallback)((function(e){var n;e.length>0&&(null===(n=_.current)||void 0===n||n.triggerActiveComment(e),q.s.emit(X.M.COMMENT_POSITION_CHANGE_PC))}),[]),$t=Object(y.useCallback)((function(e){q.s.emit(J.Y.COMMENT_MATCH_CHANGE,e)}),[]),Qt=Object(y.useCallback)(function(){var e=l()(i.a.mark((function e(n){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ne||!(n.length>0)){e.next=3;break}return e.next=3,Dt();case 3:null===(o=p.current)||void 0===o||o.eventEmitter.trigger("searchMatchHighlight",n);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[]),Zt=Object(y.useCallback)((function(e){e.stopPropagation(),setTimeout((function(){p.current&&(p.current.setActiveComment(0,{forceScroll:!0}),et.current=document.querySelector(".bear-web-x-container").scrollTop)}))}),[]),en=Object(y.useCallback)((function(e){e.target===Re.current&&(ke.current&&(Te.current.forEach((function(e){return e()})),Te.current=[]),q.s.emit($.g.DOC_COMMENT_SHOW_CHANGE_TRANSITION_END,ke.current),we(!0))}),[]),tn=Object(y.useCallback)((function(){Object(B.P)("ccm_doc_content_page_click",{record_id:Object(M.getToken)(),block_type:z.B.PAGE},{click:"click_show_comment",target:"ccm_comment_view"}),zt(),Object(U.N)("ccm_comment_view",{source:"show_panel_click",comment_type:"part_comment"})}),[zt]),nn=function(e){p.current&&p.current.loadImageCover(e)},on=function(e){var n=e.mode;p.current&&p.current.setTheme(n&&"DARK"===n.toUpperCase()?"dark":"light")},rn=function(){var e=l()(i.a.mark((function e(){var n,o,r,c,a,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.getData().comments.filter((function(e){return!e.isWhole&&!e.finished})),o=n.map((function(e){return{commentId:e.commentId,replyIds:e.replyList.filter((function(e){return!e.deleted})).map((function(e){return e.replyId}))}})),r=f.getPlugin("translate"),c=M.commentSDKHelper.showPicLimitDialogIfNecessary,!r){e.next=11;break}return r.resetAllTranslateStatus(),a=ee.a.getState().appState.translate.config.target_lang,e.next=9,r.batchTranslate({comments:o,targetLang:a,taskId:M.taskIdController.getTaskId()});case 9:(l=e.sent)&&c(l.code);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),cn=function(){var e=f.getPlugin("translate");e&&e.resetAllTranslateStatus()},an=Object(y.useCallback)((function(e,n,o){(n.deletedComments.length>0||n.resolveStatusChangedComments.length>0)&&Be(null)}),[f]),ln=Object(y.useCallback)((function(e,n,o){var r=e.comments.filter((function(e){return!e.isWhole&&!e.finished})),c=f.getPlugin("translate");if(c&&(c.triggerLangDetection(r),ee.a.getState().appState.translate.status.translated)){var i=e.comments.filter((function(e){return!e.isWhole&&!e.finished})).map((function(e){return{commentId:e.commentId,replyIds:e.replyList.filter((function(e){return!e.deleted})).map((function(e){return e.replyId}))}})),a=ee.a.getState().appState.translate.config.target_lang;c.batchTranslate({comments:i,targetLang:a})}}),[f]),mn=Object(y.useCallback)((function(e){var n,o=e.commentId,r=e.replyId;null===(n=p.current)||void 0===n||n.eventEmitter.trigger("jumpReply",[o,r])}),[]),un=function(){return R.S.isFeishuRooms?Je&&"1"===Je.get("tenant_id"):R.S.isInVC&&it},sn=function(){var e,n,o;if(R.S.isInVC){var r=document.querySelector(".bear-web-x-container"),c=et.current;if(r&&Math.abs(r.scrollTop-c)>=800){var i=(null===(e=window)||void 0===e||null===(n=e.vcSdk)||void 0===n||null===(o=n.context)||void 0===o?void 0:o.participant_count)>=3,a=wt.current.length>=2,l=Ze.current;a&&i&&Et&&!tt.current&&un()&&!l&&(ct(!0),Object(U.N)("ccm_comment_inturn_guide_tips_view"),Ze.current=!0,Xe.current&&(clearTimeout(Xe.current),Xe.current=null),Xe.current=window.setTimeout((function(){ct(!1)}),5e3))}}};Object(y.useEffect)((function(){et.current=document.querySelector(".bear-web-x-container").scrollTop}),[Et]),Object(y.useEffect)((function(){It.current=St}),[St]),Object(y.useEffect)((function(){var e=document.querySelector(".bear-web-x-container");return dt&&e&&e.addEventListener("scroll",sn),function(){dt&&e&&e.removeEventListener("scroll",sn)}})),Object(y.useEffect)((function(){Ge.current=Ve}),[Ve]),Object(y.useEffect)((function(){"boolean"===typeof a&&Rt(a)}),[]),Object(y.useEffect)((function(){return q.s.on(q.p.TRANSLATE.TRANSLATE_EVENT_DONE,rn),q.s.on(q.p.TRANSLATE.TRANSLATE_EVENT_CLOSE,cn),q.s.on(q.p.TRANSLATE.TRANSLATE_LANGUAGE_CHANGE,rn),q.s.on(J.Y.COMMENT_HIGHLIGHT_CHANGE,Qt),function(){q.s.off(q.p.TRANSLATE.TRANSLATE_EVENT_DONE,rn),q.s.off(q.p.TRANSLATE.TRANSLATE_EVENT_CLOSE,cn),q.s.off(q.p.TRANSLATE.TRANSLATE_LANGUAGE_CHANGE,rn),q.s.off(J.Y.COMMENT_HIGHLIGHT_CHANGE,Qt)}}),[]),Object(y.useEffect)((function(){return f.on("commentDataChange",an),f.on("commentDataChangeRemote",ln),function(){f.off("commentDataChange",an),f.off("commentDataChangeRemote",ln)}})),Object(y.useEffect)((function(){return q.s.on(Q.E,nn),function(){q.s.off(Q.E,nn)}}),[]),Object(y.useEffect)((function(){var e;Pe.current=ze,null===(e=p.current)||void 0===e||e.eventEmitter.trigger("guideStateChange",[])}),[ze]),Object(y.useEffect)((function(){n.on(X.M.COMMENT_POSITION_CHANGE,Ht),n.on(X.M.ACTIVATE_COMMENT,Bt),n.on(X.M.JUMP_REPLY,mn),n.on(X.M.DEACTIVATE_COMMENT,Wt),n.on(X.M.START_NEW_DOC_COMMENT,Ut),n.on(X.M.COMMENT_READY,Ft);var e=Object(b.onUIStateChange)(on);if(n.getIsReady()&&Ft(),v.current){var r=M.commentSDKHelper.MentionPlugin,c=M.commentSDKHelper.TranslateLimitPlugin,i=M.commentSDKHelper.UserProfilePlugin,a=M.commentSDKHelper.UnloadReminderPlugin,l=M.commentSDKHelper.AdminControlPlugin,m=M.commentSDKHelper.getCommentImageEnabled,u=M.commentSDKHelper.CommentUserGuidePlugin,s={commentSDK:f,logContext:Object(W.d)(n,!1),isGlobal:!1},C=new S.CommentView({container:v.current,commentSDK:f,registerPlugins:function(e){var m=[new Ee({commentModule:n,isInCheckComment:function(){return Qe.current},rootSelector:d.editor}),new r({commentSDK:f}),new i,new a({eventEmitter:e.eventEmitter,history:M.history}),new oe.S,new Ce(ue({commentView:e},s)),new ve(s),new l,new c];return o&&(_.current=new ie.S({commentView:e,vcController:o,eventEmitter:e.eventEmitter,showComment:Rt,positionListRef:Z,commentListRef:wt,commentModule:n,newClickContentAlignEnabled:ft,fileType:"docX"}),m.push(_.current)),R.S.isInVC||m.push(new u({isOnboardingInputGuideDoneRef:Pe,eventEmitter:e.eventEmitter})),m},commentContainerProps:{defaultActiveCommentId:n.activeCommentId,commentFilter:function(e){return e.filter((function(e){return!e.finished&&!e.isWhole}))},theme:Object(b.getCurrentThemeType)()===b.ThemeType.DARK?"dark":"light",scrollContainer:d.root,modules:{position:{strategy:"absolute",minOffsetTop:88,enableAbsoluteScrollAnimation:Ct,disableScroll:n.disableScrollInVC},translate:{enabled:!Object(D.E)(),getConfig:M.commentSDKHelper.getTranslateConfig},image:{enabled:m(),useBlob:R.S.isOpendoc},search:{enabled:!0},permission:ue({enabled:!0,getShowGrantPopover:function(){return It.current}},M.getCommentCopyableOptions?Object(M.getCommentCopyableOptions)():{}),mention:{enabled:!0,mentionBox:{zIndex:200,udMention:vt}},draft:{mode:S.DRAFT_MODE.DEFAULT,writable:!!R.S.isInVC&&at,readable:!!R.S.isInVC&&at},hover:{controlEnabled:lt},commentFollow:{enabled:R.S.isInVC&&st},optimize:{loadingAndFail:mt,loadingV2:ut}},positionList:[],registerEditorPlugin:M.commentSDKHelper.registerEditorPlugin,reporter:new S.Reporter({serviceToken:f.serviceToken,serviceType:f.serviceType,view:"docx",reporterHandler:function(e,n){return Object(U.N)(e,n)}})}});p.current=C,C.on("activeCommentChange",Kt),C.on("hoverCommentChange",Xt),C.on("firstCommentShowStatusChange",qt),C.on("commentListChange",Jt),C.on("searchMatchChange",$t),n.updateAllCommentPosition(!0)}return setTimeout((function(){Ae.current=!1})),function(){e(),n.off(X.M.COMMENT_POSITION_CHANGE,Ht),n.off(X.M.ACTIVATE_COMMENT,Bt),n.off(X.M.DEACTIVATE_COMMENT,Wt),n.off(X.M.START_NEW_DOC_COMMENT,Ut),n.off(X.M.COMMENT_READY,Ft),n.off(X.M.JUMP_REPLY,mn),p.current&&(p.current.off("activeCommentChange",Kt),p.current.off("hoverCommentChange",Xt),p.current.off("firstCommentShowStatusChange",qt),p.current.off("commentListChange",Jt),p.current.off("searchMatchChange",$t),p.current.destroy())}}),[n,f,o,_,Ht,Ut,qt,Kt,Xt,Bt,Wt,Rt]),Object(y.useEffect)((function(){if(!ke.current&&0===Z.current.length&&g.length>0&&(!R.S.isInVC&&!R.S.isFeishuRooms||!(null===o||void 0===o?void 0:o.isFollow))){var e=function(){if(M.localStorageAvailable){var e=M.localStorageUtil.getItem("docCommentShown");return"boolean"===typeof e&&e}return null}(),n=!(null!==e&&!R.S.isInVC)||e;n&&p.current&&p.current.setContainerVisible(!0),Rt(!!n),Ae.current=!0,setTimeout((function(){Ae.current=!1}))}Z.current=g}),[g,Rt]),Object(y.useEffect)((function(){wt.current=xt}),[xt]),Object(y.useEffect)((function(){p.current&&(!Ne&&p.current.setActiveComment(null),p.current.setContainerVisible(Ne))}),[Ne]),Object(y.useEffect)((function(){ke.current=Ne,n.eventCollector.collectEvent(K.l.showCommentPanel,{showComment:Ne}),q.s.emit($.g.DOC_COMMENT_SHOW_CHANGE,ke.current)}),[n,Ne]),Object(y.useEffect)((function(){var e;je.current===Ne&&Mt&&(null===(e=_.current)||void 0===e||e.triggerShowComment(Ne))}),[n,Ne,Mt]),Object(y.useEffect)((function(){return function(){Le||C(Object(G.Y)(!1)),je.current=!1}}),[C,Le]),Object(y.useEffect)((function(){jt.current.didUpdate(P.ET.RENDER_DOCX_COMMENT_SUCCESS)})),Object(y.useEffect)((function(){Ne&&R.S.isInVC&&Et&&!Ye&&(qe.current&&clearTimeout(qe.current),Object(M.addSteps)(M.STEP_TYPES.ccm_check_comment_start_guide),qe.current=setTimeout((function(){Object(M.hideSteps)(M.STEP_TYPES.ccm_check_comment_start_guide),Object(M.completeSteps)(M.STEP_TYPES.ccm_check_comment_start_guide),qe.current=null}),5e3)),!Ne&&R.S.isInVC&&Object(M.hideSteps)(M.STEP_TYPES.ccm_check_comment_start_guide)}),[Et,Ye,Ne,Ke===M.StatusMap.loaded]),Object(y.useEffect)((function(){var e=function(){var e=l()(i.a.mark((function e(o){var r,c,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.commentId,c=o.isPassive,Qe.current=!1,c){e.next=10;break}return e.next=5,Object(Y.E)(10);case 5:return e.next=7,Bt({commentId:r});case 7:n.commentScroller.scrollToComment(r,"receiveActiveComment"),e.next=11;break;case 10:p.current&&_.current&&(a=_.current.getActiveCommentId(),p.current.setActiveComment(a),!a&&n.activeCommentChange({activeCommentId:a,prevActiveCommentId:r,callSource:"CheckComment"}));case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return M.EventEmitter.on(de.RECEIVE_ACTIVE_COMMENT,e),function(){M.EventEmitter.off(de.RECEIVE_ACTIVE_COMMENT,e)}}),[Bt]),Object(y.useEffect)((function(){var e;(Qe.current!==$e&&n.updateStoreCommentPosition([],"SwitchCheckComment"),Qe.current=$e,!$e&&gt.reset(),!$e&&R.S.isInVC&&at)&&(null===(e=p.current)||void 0===e||e.eventEmitter.trigger("backfillDraft",[]))}),[$e,gt]),Object(y.useEffect)((function(){return Nt(!1),function(){Xe.current&&clearTimeout(Xe.current)}}),[]),Object(y.useEffect)((function(){n.activeCommentId&&Bt({commentId:n.activeCommentId})}),[]);var dn={position:"sticky",top:40,zIndex:3},fn=function(e){var n;e.stopPropagation();var o=Ue&&kt(Ue),r=o&&o.unSubmitted||xt.length>0&&xt.filter((function(e){return!e.unSubmitted})).length<=0;xt.length<=0||!!r||(null===(n=p.current)||void 0===n||n.setActiveComment(null),Object(U.N)("ccm_comment_click",{click:"in_turn_start_click",target:"ccm_comment_view",comment_mode:"normal_vc"}),Object(M.completeSteps)(M.STEP_TYPES.ccm_check_comment_start_guide),M.EventEmitter.emit(de.SEND_ACTIVE_COMMENT,{commentId:Ue}),M.EventEmitter.emit(O.FOLLOW_ACTION,{module:"CheckComment",actionType:"CheckCommentToggle",data:{shown:!0}}),Nt(!0),rt&&(Ze.current=!0,ct(!1)))};return x.a.createElement(M.WithBeforeUnloadReminder,{history:e.history,hasUnSaveData:function(){var e;if(n.getTempCommentIds().size>0)return!0;var o=null===(e=Re.current)||void 0===e?void 0:e.querySelectorAll(".outerdocbody");if(!o||!o.length)return!1;var r,c=ae(o);try{for(c.s();!(r=c.n()).done;){if(r.value.innerText.trim().length>1)return!0}}catch(i){c.e(i)}finally{c.f()}return!1},getUnSaveTip:function(){return t("comment.leave_page_warning_message")}},x.a.createElement(x.a.Fragment,null,!Ne&&xe&&!Le&&x.a.createElement(re.S,{commentModule:n,blockManager:r,fold:c}),!Le&&function(){if(0===g.length&&!Ne)return null;var e=Se?["mouseEnter"]:["keyDown"];return x.a.createElement(ce.P,null,x.a.createElement(T.Tooltip,{title:t("comment.show_comment"),placement:"left",overlayStyle:{display:Ne?"none":"block"},showAction:e},x.a.createElement(ce.Y,null,x.a.createElement(ce.d,{show:!Ne,onClick:tn,onTransitionEnd:Yt},x.a.createElement(I.S,{className:"add-comment-btn"})))))}(),x.a.createElement(ce.H,{noAnimation:Ae.current,show:Ne,onTransitionEnd:en,ref:Re,className:j.b3.LAZY_SELECTION_NODE,hideContainer:un()&&$e},x.a.createElement(ce.h,null,!Le&&x.a.createElement(ce.u,null,x.a.createElement("span",null,t("comment.side_header_text",void 0,void 0,"".concat(g.length))),R.S.isInVC&&it&&Et&&function(){var e=Ue&&kt(Ue),n=e&&e.unSubmitted||xt.length>0&&xt.filter((function(e){return!e.unSubmitted})).length<=0,o=xt.length<=0||!!n,r=M.LANG_MAP.zh||M.LANG_MAP.zh_hant||M.LANG_MAP.zh_hk||M.LANG_MAP.zh_tw,c=t("CreationDoc_Docs_CheckComments_start_tooltipTitle");return o&&(c=t(n?"CreationDoc_Docs_CommentDiscussion_CannotStart":"CreationDoc_Docs_CheckComments_none_toast")),x.a.createElement(T.Tooltip,{title:c,placement:"left",trigger:"hover",overlayStyle:{display:o||!r?"block":"none"}},x.a.createElement(pe,{show:!0,disable:o,color:"var(--primary-pri-500)",onClick:fn},x.a.createElement("span",null,t("CreationDoc_Docs_CheckComments_start_btn"))))}(),x.a.createElement(T.Tooltip,{title:t("comment.hide_comment"),placement:"left",showAction:["mouseEnter"],overlayStyle:{display:Ne?"block":"none"}},x.a.createElement(ce.uS,{onClick:zt},x.a.createElement(A.S,null)))),x.a.createElement(T.Notice,{message:"",type:"info",description:t("CreationDoc_Docs_CheckComments_StartNoticeForPC"),visible:rt,style:dn,banner:!0}),x.a.createElement(ce.n,{show:se,onClick:Zt},x.a.createElement(k.S,null),x.a.createElement("span",null,t("comment.go_first_comment")))),x.a.createElement(ce.PB,{className:K.Z,ref:v})),f&&fe&&R.S.isInVC&&x.a.createElement(fe,{commentSDK:f,editor:gt,scrollContainer:d.root,commentViewPlugin:{secLinkPlugin:new oe.S},disableScroll:n.disableScrollInVC})))}));n.S=ge}).call(this,o("dx_E9Eu"))},dx_NwkU:function(e,n,o){"use strict";o.d(n,"T",(function(){return N}));var r=o("dx_lwsE"),c=o.n(r),i=o("dx_W8MJ"),a=o.n(i),l=o("dx_W7W2"),m=o.n(l),u=o("dx_a1gu"),s=o.n(u),d=o("dx_Nsbk"),f=o.n(d),C=o("dx_lSNA"),v=o.n(C),p=o("dx_cDcd"),_=o("dx_O4O8"),E=o.n(_),h=o("dx_ahlY"),g=o("dx_DbCN"),O=o("dx_TfZh"),b=o("dx_B28d"),S=o("dx_eGDr"),I=o("dx_Ayao"),A=o("dx_D8nn"),T=o("dx_MUhB");function M(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=f()(e);if(n){var c=f()(this).constructor;o=Reflect.construct(r,arguments,c)}else o=r.apply(this,arguments);return s()(this,o)}}var y=v()({},b.B.BITABLE,34),x=function(e){m()(o,e);var n=M(o);function o(e,r,i,a){var l;return c()(this,o),(l=n.call(this)).commentModule=e,l.blockManager=r,l.onActiveCommentChange=i,l.onActiveCommentComplete=a,l.activeCommentId=null,l.offset=0,l.panelTop=0,l.handleActivateComment=function(e,n,o,r){if(o!==l.activeCommentId||l.panelTop!==r){var c=l.activeCommentId,i=0;if(o){var a=l.commentModule.getPositionByCommentId(o);if(a){var m=a.blockId,u=l.blockManager.getBlockModelByBlockId(m);y[u.type]&&(i=y[u.type])}}l.offset=i,l.panelTop=r,l.activeCommentId=o,l.onActiveCommentChange(o),l.commentModule.activeCommentChange({activeCommentId:o,prevActiveCommentId:c,callSource:"CheckComment",panelTop:r+i,complete:l.onActiveCommentComplete}),Object(T.t)("CheckComment","activateComment call - cur: ".concat(o,", prev: ").concat(c))}else Object(T.t)("CheckComment","activateComment call return cause not change, cur: ".concat(o,"\u3001").concat(r)+", prev: ".concat(l.activeCommentId,"\u3001").concat(l.panelTop))},l.scrollPosition=function(e){return l.activeCommentId===e&&l.commentModule.commentScroller.scrollToComment(e,"scrollPosition",{panelTop:l.panelTop+l.offset})},l}return a()(o,[{key:"setCommentModule",value:function(e){this.commentModule=e}},{key:"reset",value:function(){this.offset=0,this.panelTop=0,this.activeCommentId=null}},{key:"viewTop",get:function(){return this.panelTop+this.offset}},{key:"plugins",get:function(){var e=this;return{comment:{deactivateComment:function(){return null},activateComment:this.handleActivateComment,saveCommentOnDoc:function(n){e.commentModule.handleCommentDidAdd(n.tempCommentId),Object(T.t)("CheckComment","saveCommentOnDoc call - commentId: ".concat(n.commentId,", tempCommentId: ").concat(n.tempCommentId))},deleteCommentOnDoc:function(e,n,o){return Object(T.t)("CheckComment","saveCommentOnDoc call - commentId: ".concat(o)),null}}}}}]),o}(E.a),w=[S.M.interaction,S.M.thirdParty];function N(e){var n=e.commentModule,o=e.scroller,r=e.vcController,c=e.positionList,i=e.blockManager,a=Object(p.useRef)(null),l=Object(p.useRef)(0),m=Object(p.useRef)(!1),u=Object(p.useRef)(),s=Object(p.useRef)(),d=Object(O.S)((function(e){var c,i=a.current,d=u.current;if(!(!i||void 0===d||m.current||l.current>=10)&&o&&(null===r||void 0===r?void 0:r.isRecord)&&n.disableScrollInVC&&s.current){var f=null===(c=n.getPositionByCommentId(i))||void 0===c?void 0:c.top;f&&Math.abs(f-d)<16||(e||Math.abs(Object(g.h)(o)+s.current.viewTop-(d+Object(h.y)()))<=2)&&(l.current++,u.current=f,s.current.scrollPosition(i))}}),100);return s.current||(s.current=new x(n,i,(function(e){var o;a.current=e,m.current=!0,e?(l.current=0,u.current=null===(o=n.getPositionByCommentId(e))||void 0===o?void 0:o.top):u.current=void 0}),(function(e){var o;a.current===e&&(m.current=!1,e&&(null===(o=n.getPositionByCommentId(e))||void 0===o?void 0:o.top)!==u.current&&d(!0))}))),Object(p.useEffect)((function(){return d()}),[c]),Object(p.useEffect)((function(){var e,o=function(e){var n,o=e.commentId,r=e.from;r&&w.includes(r)&&(null===(n=s.current)||void 0===n||n.emit("clickCommentOnDoc",{commentId:o}))},r=function(){var e;null===(e=s.current)||void 0===e||e.emit("reSendActiveComment")};return n.on(I.M.ACTIVATE_COMMENT,o),null===(e=s.current)||void 0===e||e.setCommentModule(n),A.N.on(A.p.COMMON.CLOSED_IMAGE_VIEWER,r),function(){n.off(I.M.ACTIVATE_COMMENT,o),A.N.off(A.p.COMMON.CLOSED_IMAGE_VIEWER,r)}}),[n]),s.current}},dx_Z4vw:function(e,n,o){"use strict";o.r(n);var r=o("dx_MQSr");n.default=r.S},dx_kQkB:function(e,n,o){"use strict";var r=o("dx_J4zp"),c=o.n(r),i=o("dx_cDcd"),a=o.n(i),l=o("dx_h74D"),m=o("dx_E2oU"),u=o("dx_Fimk"),s=o("dx_eGDr"),d=o("dx_upU1"),f=o("dx_p9pl"),C=o("dx_FHNI"),v=o("dx_Ayao");var p=function(e){var n=e.commentModule,o=e.blockManager,r=e.fold,p=e.config,_=function(e,n,o,r){var a=Object(i.useCallback)((function(){var c={};return Object(d.j)(n,o).map((function(e){return n.getRecordByBlockId(e).id})).reduce((function(n,o){var r=e.getCommentsByRecordId(o);return null===r||void 0===r||r.forEach((function(e){return n.add(e)})),n}),new Set).forEach((function(o){var i=e.getCommentByCommentId(o),a=e.getPositionByCommentId(o);if(i&&a){if(r&&e.isThirdPartyComment(o)){var l=n.getBlockModelByBlockId(a.blockId);if(r[l.type]&&!r[l.type].visible)return}var m=i.commentList||i.replyList||[],u=a.top;if(u){var s=c[u]||{},d=s.commentIds,f=void 0===d?[]:d,C=s.listCount,v=(void 0===C?0:C)+m.length;v>0&&(c[u]={commentIds:f.concat(o),listCount:v})}}})),Object.keys(c).length>0&&Object.keys(c).map(Number).sort((function(e,n){return e-n})).reduce((function(e,n){if(n<e+s.K){var o=c[e],r=c[n];return c[e]={listCount:o.listCount+r.listCount,commentIds:o.commentIds.concat(r.commentIds)},delete c[n],e}return n})),Object.values(c).forEach((function(n){n.commentIds.sort((function(n,o){var r=e.getPositionByCommentId(n),c=e.getPositionByCommentId(o);return r.left-c.left}))})),c}),[e,n]),l=Object(i.useState)((function(){return a()})),m=c()(l,2),u=m[0],f=m[1],C=Object(i.useCallback)((function(){f(a())}),[a]);return Object(i.useEffect)((function(){return e.on(v.M.COMMENT_POSITION_CHANGE,C),function(){e.off(v.M.COMMENT_POSITION_CHANGE,C)}}),[e,C]),u}(n,o,r,p),E=Object(l.useSelector)(m.j),h=Object(i.useCallback)((function(e){var o=_[e].commentIds.map((function(e){return[e,n.getPositionByCommentId(e)]})).filter((function(e){return!!e[1]})).sort(d.c);n.activateComment(o[0][0],void 0,s.M.numbers),Object(u.N)("ccm_comment_view",{source:"bubble_click",comment_type:"part_comment"})}),[n,_]);return E?a.a.createElement(C.F,{className:"docx-comment-numbers"},Object.entries(_).map((function(e){var n=c()(e,2),o=n[0],r=n[1].listCount;return r>0?a.a.createElement(f.S,{key:o,listCount:r,numberTop:Number(o),onClick:h}):null}))):null};n.S=p},dx_mf1r:function(e,n,o){"use strict";var r=o("dx_cDcd"),c=o.n(r);function i(){return i=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},i.apply(this,arguments)}var a=c.a.createElement("path",{fill:"#2B2F36",d:"M12.014 10v3.781H9.082V10H6.68a.681.681 0 01-.526-1.115l3.825-4.636a.681.681 0 011.052.001l3.808 4.637A.68.68 0 0114.313 10h-2.298zm-3.008 4.984h3.013v1.474c0 .296-.24.535-.535.535H9.541a.536.536 0 01-.535-.535v-1.474z",mask:"url(#icon_comment_go_first_svg__prefix__b)",transform:"matrix(1 0 0 -1 0 20.993)"});n.S=function(e){return c.a.createElement("svg",i({width:20,height:20,viewBox:"0 0 20 20"},e),a)}},dx_oQzG:function(e,n,o){"use strict";o.d(n,"S",(function(){return h}));var r=o("dx_lwsE"),c=o.n(r),i=o("dx_W8MJ"),a=o.n(i),l=o("dx_W7W2"),m=o.n(l),u=o("dx_a1gu"),s=o.n(u),d=o("dx_Nsbk"),f=o.n(d),C=o("dx_NWnn"),v=o("dx_xs2W"),p=o("dx_HsgL");function _(e,n,o){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e){if(e=Object(v.z)(e,!1),!r&&Object(v.y)(n,e))return;Object(p.n)(e,"_blank")}}function E(e){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=f()(e);if(n){var c=f()(this).constructor;o=Reflect.construct(r,arguments,c)}else o=r.apply(this,arguments);return s()(this,o)}}var h=function(e){m()(o,e);var n=E(o);function o(){var e;c()(this,o);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).pluginName="open-link",e}return a()(o,[{key:"replyLinkDidClick",value:function(e,n){n.preventDefault(),_(e.url,n,!1)}},{key:"suiteBlockDidClick",value:function(e,n){n.preventDefault(),_(e.href,n,!1)}}]),o}(C.CommentViewPlugin)},dx_p9pl:function(e,n,o){"use strict";(function(t){var e=o("dx_PcQO"),r=o("dx_cDcd"),c=o.n(r),i=o("dx_yzqx"),a=o("dx_FHNI");n.S=function(n){var o=n.listCount,l=n.numberTop,m=n.onClick,u=Object(r.useCallback)((function(){m(l)}),[l,m]),s=o>99?"99+":o;return c.a.createElement(a.t,{style:{top:l},onClick:u},c.a.createElement(a.j,null,c.a.createElement(e.Tooltip,{disabled:i.S.isMobile||i.S.isIPad&&i.S.isLark,title:t("comment.show_comment"),placement:"left"},c.a.createElement(a.l,null,s))))}}).call(this,o("dx_E9Eu"))},dx_xBwW:function(e,n,o){"use strict";o.d(n,"S",(function(){return c}));var r=o("dx_cDcd");function c(e,n){var o=Object(r.useRef)(!1),c=Object(r.useCallback)((function(){o.current&&(n.cancel(),o.current=!1)}),[n]),i=Object(r.useCallback)((function(){o.current=!0,window.requestAnimationFrame((function(){o.current&&(o.current=!1)}))}),[]);return Object(r.useEffect)((function(){var n=document.querySelector(e);if(n)return n.addEventListener("scroll",c),function(){n.removeEventListener("scroll",c)}}),[e,c]),i}}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=docx_index_delay_comment.766236d5.chunk.js.map